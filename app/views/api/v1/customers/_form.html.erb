<%= form_with model: [:api, :v1, @customer], local: true, class: "space-y-6 bg-white p-6 rounded-lg shadow-md" do |f| %>
  <% if customer.errors.any? %>
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4" role="alert">
      <p class="font-bold">Se encontraron <%= pluralize(@customer.errors.count, "error") %>:</p>
      <ul class="mt-2 list-disc list-inside">
        <% customer.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
	<div>
		<% label_text = @customer.person_type == 'juridica' ? "Razón social" : "Nombre Completo" %>
		<%= f.label :full_name, label_text, id: "full-name-label", class: "block text-sm font-medium text-gray-700" %>
		<%= f.text_field :full_name, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm" %>
	</div>
    <div>
      <%= f.label :email, "Email", class: "block text-sm font-medium text-gray-700" %>
      <%= f.email_field :email, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>
	<div>
		<%= f.label :person_type, "Tipo de Persona", class: "block text-sm font-medium text-gray-700" %>
		<%= f.select :person_type, 
			[['Persona Natural', 'natural'], ['Persona Jurídica', 'juridica']], 
			{}, 
			{ id: "person-type-select", 
				class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500",
				onchange: "updateLabels(this.value)" } %>
	</div>
    <div>
		<% person_type_text = @customer.person_type == 'juridica' ? "RIF" : "C.I./Pasaporte" %>
		<%= f.label :full_name, person_type_text, id: "id-number-label", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_field :id_number, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>
    <div>
      <%= f.label :phone_primary, "Teléfono Principal", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_field :phone_primary,  class: "phone-input-mask mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",
	  placeholder: "0..." %>
    </div>
	<div>
      <%= f.label :phone_secondary, "Teléfono Secundario", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_field :phone_secondary, class: "phone-input-mask mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500",
	  placeholder: "0..." %>
    </div>
    <div>
      <%= f.label :issue_date, "Fecha de Emisión", class: "block text-sm font-medium text-gray-700" %>
      <%= f.date_field :issue_date,value: f.object.issue_date&.strftime('%Y-%m-%d'), class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>
    <div>
      <%= f.label :expiry_date, "Fecha de Expiración", class: "block text-sm font-medium text-gray-700" %>
      <%= f.date_field :expiry_date, class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>

  </div>

  <div class="mt-6">
    <%= f.submit "Guardar Cambios", class: "w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer" %>
  </div>
<% end %>

<script>
	function updateLabels(value) {
		const nameLabel = document.getElementById("full-name-label");
		const idLabel = document.getElementById("id-number-label");

		if (value === "juridica") {
		if (nameLabel) nameLabel.innerText = "Razón Social";
		if (idLabel) idLabel.innerText = "RIF";
		} else {
		if (nameLabel) nameLabel.innerText = "Nombre Completo";
		if (idLabel) idLabel.innerText = "C.I. / Pasaporte";
		}
	}

	function setupPhoneMask() {
		const phoneInputs = document.querySelectorAll(".phone-input-mask");
		
		phoneInputs.forEach(function(input) {
		if (input.value === "") {
			input.value = "0";
		}

		input.addEventListener("input", function() {
			let val = this.value.replace(/\D/g, "");
			
			// Asegura que siempre inicie con 0
			if (!val.startsWith("0")) {
			val = "0" + val;
			}
			
			this.value = val;
		});
		});
	}
	document.addEventListener("turbo:load", setupPhoneMask);
	document.addEventListener("DOMContentLoaded", setupPhoneMask);
</script>